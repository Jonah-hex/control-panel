# ๐ข ุฏููู ุญูุธ ุจูุงูุงุช ุงูุนูุงุฑุฉ ุงููุงูู
# Complete Building Data Save Guide

## ๐ ุงููุญุชููุงุช | Contents

1. [ุงูุจูุงูุงุช ุงูุชู ูุชู ุญูุธูุง](#data-saved)
2. [ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ](#tables-used)
3. [ุงูุณูููุงุช ุงููุทููุจุฉ](#required-schemas)
4. [ุฎุทูุงุช ุงูุชุทุจูู](#implementation-steps)
5. [ุญู ุงููุดุงูู](#troubleshooting)

---

## ๐ ุงูุจูุงูุงุช ุงูุชู ูุชู ุญูุธูุง | Data Being Saved

### 1๏ธโฃ ุฌุฏูู Buildings (37 ุญูู)

#### ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ (6 ุญููู)
- โ `name` - ุงุณู ุงูุนูุงุฑุฉ (ูุทููุจ)
- โ `plot_number` - ุฑูู ุงููุทุนุฉ (ูุทููุจ)
- โ `neighborhood` - ุงูุญู
- โ๏ธ `address` - ุงูุนููุงู (ุบูุฑ ููุนูู ุญุงููุงู - ูุญุชุงุฌ ุชุญุฏูุซ ุงูุณูููุง)
- โ `description` - ุงููุตู
- โ `phone` - ุฑูู ุงููุงุชู

#### ุชูุงุตูู ุงูุจูุงุก (9 ุญููู)
- โ `total_floors` - ุนุฏุฏ ุงูุทูุงุจู (ูุญุณูุจ ุชููุงุฆูุงู)
- โ `total_units` - ุนุฏุฏ ุงููุญุฏุงุช (ูุญุณูุจ ุชููุงุฆูุงู)
- โ `reserved_units` - ุงููุญุฏุงุช ุงููุญุฌูุฒุฉ
- โ `parking_slots` - ููุงูู ุงูุณูุงุฑุงุช
- โ `driver_rooms` - ุบุฑู ุงูุณุงุฆููู
- โ `elevators` - ุงููุตุงุนุฏ
- โ `street_type` - ููุน ุงูุดุงุฑุน (one/two/corner)
- โ `building_facing` - ูุงุฌูุฉ ุงูุนูุงุฑุฉ (north/south/east/west)
- โ `year_built` - ุณูุฉ ุงูุจูุงุก

#### ุงููุนูููุงุช ุงููุงููููุฉ (4 ุญููู)
- โ `build_status` - ุญุงูุฉ ุงูุจูุงุก (ready/under_construction)
- โ `deed_number` - ุฑูู ุงูุตู
- โ `land_area` - ูุณุงุญุฉ ุงูุฃุฑุถ
- โ `building_license_number` - ุฑูู ุฑุฎุตุฉ ุงูุจูุงุก

#### ูุนูููุงุช ุงูุชุฃููู (2 ุญููู)
- โ `insurance_available` - ูุฌูุฏ ุชุฃููู
- โ `insurance_policy_number` - ุฑูู ูุซููุฉ ุงูุชุฃููู

#### ุนุฏุงุฏุงุช ุงููุฑุงูู (4 ุญููู)
- โ `has_main_water_meter` - ูุฌูุฏ ุนุฏุงุฏ ููุงู ุฑุฆูุณู
- โ `water_meter_number` - ุฑูู ุนุฏุงุฏ ุงูููุงู
- โ `has_main_electricity_meter` - ูุฌูุฏ ุนุฏุงุฏ ููุฑุจุงุก ุฑุฆูุณู
- โ `electricity_meter_number` - ุฑูู ุนุฏุงุฏ ุงูููุฑุจุงุก

#### ูุนูููุงุช ุงูุญุงุฑุณ (7 ุญููู)
- โ `guard_name` - ุงุณู ุงูุญุงุฑุณ
- โ `guard_phone` - ุฑูู ูุงุชู ุงูุญุงุฑุณ
- โ `guard_room_number` - ุฑูู ุบุฑูุฉ ุงูุญุงุฑุณ
- โ `guard_id_photo` - ุตูุฑุฉ ูููุฉ ุงูุญุงุฑุณ
- โ `guard_shift` - ููุจุฉ ุงูุนูู
- โ `guard_has_salary` - ูุฌูุฏ ุฑุงุชุจ
- โ `guard_salary_amount` - ูุจูุบ ุงูุฑุงุชุจ

#### ุจูุงูุงุช JSONB (2 ุญููู)
- โ `floors_data` - ุจูุงูุงุช ุงูุทูุงุจู ูุงููุญุฏุงุช (JSONB)
- โ `owner_association` - ุจูุงูุงุช ุงุชุญุงุฏ ุงูููุงู (JSONB - 12 ุญูู ูุฑุนู)

#### ุจูุงูุงุช ุฅุถุงููุฉ (4 ุญููู)
- โ `google_maps_link` - ุฑุงุจุท ุฎุฑุงุฆุท ุฌูุฌู
- โ `image_urls` - ุฑูุงุจุท ุงูุตูุฑ (Array)
- โ `owner_id` - ูุนุฑู ุงููุงูู (ุชููุงุฆู)
- โ `created_at` - ุชุงุฑูุฎ ุงูุฅูุดุงุก (ุชููุงุฆู)

### 2๏ธโฃ ุงุชุญุงุฏ ุงูููุงู JSONB (12 ุญูู ูุฑุนู)

ุนูุฏ ุชูุนูู `hasAssociation = true`:
- โ `hasAssociation` - ูุฌูุฏ ุงุชุญุงุฏ ููุงู
- โ `managerName` - ุงุณู ุงููุฏูุฑ
- โ `registrationNumber` - ุฑูู ุงูุชุณุฌูู
- โ `registeredUnitsCount` - ุนุฏุฏ ุงููุญุฏุงุช ุงููุณุฌูุฉ ุจุงูุงุชุญุงุฏ โญ NEW
- โ `iban` - ุฑูู ุงูุขูุจุงู
- โ `accountNumber` - ุฑูู ุงูุญุณุงุจ
- โ `contactNumber` - ุฑูู ุงูุชูุงุตู
- โ `startDate` - ุชุงุฑูุฎ ุงูุจุฏุงูุฉ
- โ `endDate` - ุชุงุฑูุฎ ุงูููุงูุฉ
- โ `monthlyFee` - ุงูุฑุณูู ุงูุดูุฑูุฉ
- โ `includesElectricity` - ุดุงูู ุงูููุฑุจุงุก
- โ `includesWater` - ุดุงูู ุงูููุงู

### 3๏ธโฃ ุฌุฏูู Units (17 ุญูู ููู ูุญุฏุฉ)

ูุชู ุฅูุดุงุก ุตู ููู ูุญุฏุฉ ูู ุฌููุน ุงูุทูุงุจู:
- โ `building_id` - ูุนุฑู ุงูุนูุงุฑุฉ (Foreign Key)
- โ `unit_number` - ุฑูู ุงููุญุฏุฉ
- โ `floor` - ุฑูู ุงูุทุงุจู
- โ `type` - ููุน ุงููุญุฏุฉ (apartment/shop/office)
- โ `facing` - ูุงุฌูุฉ ุงููุญุฏุฉ (front/back/corner)
- โ `area` - ุงููุณุงุญุฉ
- โ `rooms` - ุนุฏุฏ ุงูุบุฑู
- โ `bathrooms` - ุนุฏุฏ ุงูุญูุงูุงุช
- โ `living_rooms` - ุนุฏุฏ ุงูุตุงูุงุช
- โ `kitchens` - ุนุฏุฏ ุงููุทุงุจุฎ
- โ `maid_room` - ุบุฑูุฉ ุฎุงุฏูุฉ
- โ `driver_room` - ุบุฑูุฉ ุณุงุฆู
- โ `entrances` - ุนุฏุฏ ุงููุฏุงุฎู
- โ `ac_type` - ููุน ุงููููู (split/central/window)
- โ `status` - ุญุงูุฉ ุงููุญุฏุฉ (available/rented/sold)
- โ `price` - ุงูุณุนุฑ
- โ `description` - ูุตู ุงููุญุฏุฉ

---

## ๐๏ธ ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ | Tables Used

### 1. ุฌุฏูู `buildings`
```sql
CREATE TABLE buildings (
  id UUID PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  plot_number VARCHAR(100),
  -- ... (37 ุนููุฏ ุฅุฌูุงูู)
  owner_association JSONB,
  floors_data JSONB,
  image_urls TEXT[],
  owner_id UUID NOT NULL REFERENCES auth.users(id)
);
```

### 2. ุฌุฏูู `units`
```sql
CREATE TABLE units (
  id UUID PRIMARY KEY,
  building_id UUID NOT NULL REFERENCES buildings(id) ON DELETE CASCADE,
  unit_number VARCHAR(50) NOT NULL,
  floor INTEGER NOT NULL,
  -- ... (17 ุนููุฏ ุฅุฌูุงูู)
  UNIQUE(building_id, unit_number)
);
```

---

## โ๏ธ ุงูุณูููุงุช ุงููุทููุจุฉ | Required Schemas

### โ ุฌุงูุฒุฉ ููุชููุฑุฉ ูู ุงูุณูููุง:
1. โ ุฌุฏูู buildings ูุน ุฌููุน ุงูุฃุนูุฏุฉ (ุจุงุณุชุซูุงุก address)
2. โ ุฌุฏูู units ูุน ุฌููุน ุงูุฃุนูุฏุฉ
3. โ RLS policies ูุฌุฏูู buildings
4. โ๏ธ RLS policies ูุฌุฏูู units (ุชุญุชุงุฌ ุชุญุฏูุซ)

### โ๏ธ ุชุญุชุงุฌ ุชุทุจูู ูู Supabase:

#### 1. ุฅุถุงูุฉ ุนููุฏ address (ุงุฎุชูุงุฑู)
```sql
-- ูููุฐ ูุฐุง ุฅุฐุง ุฃุฑุฏุช ุฅุถุงูุฉ ุญูู ุงูุนููุงู
ALTER TABLE buildings 
ADD COLUMN IF NOT EXISTS address TEXT;
```

#### 2. ุชุญุฏูุซ RLS policies ูุฌุฏูู units (ูุทููุจ)
```sql
-- ูููุฐ ุงูููู: fix_units_policies.sql
-- ูุถูู ุณูุงุณุงุช INSERT, UPDATE, DELETE ูููุญุฏุงุช
```

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู | Implementation Steps

### ุงูุฎุทูุฉ 1๏ธโฃ: ูุชุญ Supabase SQL Editor
1. ุงูุชุญ ููุญุฉ ุชุญูู Supabase
2. ุงุฐูุจ ุฅูู SQL Editor
3. ุงูุชุญ ุชุจููุจ ุฌุฏูุฏ

### ุงูุฎุทูุฉ 2๏ธโฃ: ุงูุชุญูู ูู ุงูุณูููุง ุงูุญุงูู
```sql
-- ูููุฐ ุงูููู: verify_database_schema.sql
-- ูุนุฑุถ ุฌููุน ุงูุฃุนูุฏุฉ ูุงูุณูุงุณุงุช ุงูุญุงููุฉ
```

### ุงูุฎุทูุฉ 3๏ธโฃ: ุฅุตูุงุญ ุณูุงุณุงุช units (ูุทููุจ)
```sql
-- ูููุฐ ุงูููู: fix_units_policies.sql
-- ูุถูู ุณูุงุณุงุช INSERT ูููุญุฏุงุช
```

### ุงูุฎุทูุฉ 4๏ธโฃ: ุฅุถุงูุฉ ุนููุฏ address (ุงุฎุชูุงุฑู)
```sql
-- ูููุฐ ุงูููู: add_address_column.sql (ุฅู ุฃุฑุฏุช)
-- ุซู ูุนูู ุงูุณุทุฑ ูู ุงูููุฏ:
-- address: `${formData.neighborhood} - ูุทุนุฉ ${formData.plotNumber}`,
```

---

## ๐ง ุญู ุงููุดุงูู | Troubleshooting

### โ ูุดููุฉ: Could not find the 'address' column
**ุงูุญู:** ุนููุฏ address ูุนุทูู ุญุงููุงู ูู ุงูููุฏ. ูุชูุนููู:
1. ูููุฐ `add_address_column.sql` ูู Supabase
2. ูุนูู ุงูุณุทุฑ ูู ุงูููุฏ (line ~600)

### โ ูุดููุฉ: new row violates row-level security policy for table "units"
**ุงูุญู:** ุณูุงุณุงุช RLS ูุฌุฏูู units ูุงูุตุฉ
1. ูููุฐ `fix_units_policies.sql` ูู Supabase
2. ูุถูู ุณูุงุณุงุช INSERT, UPDATE, DELETE

### โ ูุดููุฉ: duplicate key value violates unique constraint
**ุงูุญู:** ุงููุญุฏุฉ ููุฌูุฏุฉ ูุณุจูุงู
- ุชุฃูุฏ ูู ุนุฏู ุชูุฑุงุฑ ุฑูู ุงููุญุฏุฉ ูู ููุณ ุงูุนูุงุฑุฉ
- ุญุฏุฏ `UNIQUE(building_id, unit_number)`

### โ ูุดููุฉ: null value in column "name" violates not-null constraint
**ุงูุญู:** ุงูุญููู ุงููุทููุจุฉ ูุงุฑุบุฉ
- ุชุฃูุฏ ูู ููุก: ุงุณู ุงูุนูุงุฑุฉุ ุฑูู ุงููุทุนุฉ
- ุงูููุฏ ูุชุญูู ุชููุงุฆูุงู: `if (!formData.name || !formData.plotNumber)`

---

## ๐ ููุงุญุธุงุช ูููุฉ | Important Notes

### โ ูุง ูุนูู ุญุงููุงู:
- โ ุญูุธ ุฌููุน ุจูุงูุงุช ุงูุนูุงุฑุฉ (37 ุญูู)
- โ ุญูุธ ุงุชุญุงุฏ ุงูููุงู (12 ุญูู ูู JSONB)
- โ ุญูุธ ุฌููุน ุงููุญุฏุงุช (17 ุญูู ููู ูุญุฏุฉ)
- โ ุฑูุน ุงูุตูุฑ ูุญูุธ ุงูุฑูุงุจุท
- โ ุญุณุงุจ ุชููุงุฆู ูุนุฏุฏ ุงูุทูุงุจู ูุงููุญุฏุงุช
- โ ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู (RLS)

### โ๏ธ ูุญุชุงุฌ ุชุทุจูู ูู Supabase:
- โ๏ธ ุณูุงุณุงุช RLS ูุฌุฏูู units (ููู: fix_units_policies.sql)
- ๐ ุงุฎุชูุงุฑู: ุนููุฏ address (ููู: add_address_column.sql)

### ๐ฏ ุงูุฃููููุงุช:
1. **ุนุงููุฉ:** ุชุทุจูู fix_units_policies.sql (ูุทููุจ ููุญูุธ)
2. **ูุชูุณุทุฉ:** ุชุทุจูู verify_database_schema.sql (ููุชุญูู)
3. **ููุฎูุถุฉ:** ุชุทุจูู add_address_column.sql (ุงุฎุชูุงุฑู)

---

## ๐ ุฅุญุตุงุฆูุงุช | Statistics

- **ุฅุฌูุงูู ุงูุญููู ุงููุญููุธุฉ:** 66+ ุญูู
  - Buildings: 37 ุญูู
  - Owner Association: 12 ุญูู (JSONB)
  - Units: 17 ุญูู ร ุนุฏุฏ ุงููุญุฏุงุช

- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:** 2
  - buildings
  - units

- **ุงููููุงุช ุงููุณุงุนุฏุฉ:** 3
  - fix_units_policies.sql
  - verify_database_schema.sql
  - add_address_column.sql

---

## โ ุงูุฎูุงุตุฉ | Summary

ุงูููุฏ ุงูุญุงูู ูุญูุธ **ุฌููุน ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ** โ

**ุงููุทููุจ ููุท:** ุชุทุจูู `fix_units_policies.sql` ูู Supabase ูุฅุถุงูุฉ ุณูุงุณุงุช INSERT ูููุญุฏุงุช

ุจุนุฏ ุฐููุ ุงููุธุงู ุณูุนูู ุจุดูู ูุงูู 100% ๐

---

๐ ุขุฎุฑ ุชุญุฏูุซ: 2026-02-17
โ๏ธ ุชู ุชูุซูู ุฌููุน ุงูุจูุงูุงุช ูุงูุณูููุงุช ุจุงููุงูู

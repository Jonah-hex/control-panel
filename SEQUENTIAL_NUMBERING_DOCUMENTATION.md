# نظام ترقيم الوحدات التسلسلي الجديد
## Sequential Unit Numbering System

### الملخص
تم تعديل نظام ترقيم الوحدات من نظام مبني على الطابق (Floor-Based) إلى نظام تسلسلي عام (Sequential).

### النظام القديم vs الجديد

#### النظام القديم:
- الطابق 1: 0101, 0102, 0103, 0104
- الطابق 2: 0201, 0202, 0203, 0204
- الطابق 3: 0301, 0302, 0303, 0304

#### النظام الجديد:
- الطابق 1: 1, 2, 3, 4
- الطابق 2: 5, 6, 7, 8
- الطابق 3: 9, 10, 11, 12

### الملفات المعدلة

#### 1. `control-panel/src/app/dashboard/buildings/new/page.tsx`
- **إضافة دالة مساعدة**: `getSequentialUnitNumber()` 
  - تحسب رقم الوحدة التسلسلي بناءً على موضعها في إجمالي الوحدات

- **تعديل دالة `addFloor()`**:
  - حساب الرقم التسلسلي الأول للوحدات الجديدة
  - استه تخدام `String(totalExistingUnits + i + 1)` بدلاً من `${floorNumber}${String(i + 1).padStart(2, '0')}`

- **تعديل دالة `updateFloorPlan()`**:
  - إعادة حساب أرقام الوحدات باستخدام التسلسل الجديد
  - الأخذ بعين الاعتبار الوحدات الموجودة قبل الطابق الحالي

- **تعديل دالة `addUnit()`**:
  - ترقيم الوحدة الجديدة بناءً على العدد الإجمالي للوحدات الموجودة

- **تعديل دالة `duplicateUnit()`**:
  - استخدام الترقيم التسلسلي للوحدة المنسوخة

#### 2. `control-panel/src/app/dashboard/buildings/[id]/page.tsx`
- **تعديل ترتيب الوحدات**:
  - تغيير من ترتيب متعدد الأعمدة إلى ترتيب بسيط `order('unit_number', { ascending: true })`
  - الترتيب الآن يعتمد على الأرقام التسلسلية الفعلية

- **تحديث دالة `getDisplayUnitNumber()`**:
  - عرض الرقم التسلسلي مباشرة بدلاً من تحويله

### الفوائد
1. **تصفح أسهل**: الوحدات مرتبة بشكل منطقي متسلسل
2. **تعريف واضح**: كل وحدة لها رقم فريد بسيط
3. **سهولة الإدارة**: لا حاجة لحساب الطابق والموضع داخل الطابق
4. **توافق أفضل**: يعمل مع جميع نماذج المباني بغض النظر عن عدد الوحدات في كل طابق

### ملاحظات
- الوحدات القديمة الموجودة في قاعدة البيانات قد تحتاج إلى تحديث يدوي إذا كنت تريد استخدام الترقيم الجديد بشكل كامل
- يجب التأكد من أن قيم `unit_number` في قاعدة البيانات هي strings (نصية) وليست أرقام صحيحة
- الترتيب يتم بناءً على الترقيم الحرفي للاسترينج (Lexicographic ordering)، لذا قد تحتاج إلى تحويل إلى CAST(unit_number AS INTEGER) للترتيب الصناعي في بعض حالات قواعد البيانات الكبيرة
